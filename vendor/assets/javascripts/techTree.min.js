var techTree=function(e){return e.offsets=e.offsets||{},e.settings={wrapper:"#svg",downloadWrapper:"#save",nodeOrientation:"vertical",imageRendering:"pixelated",imageDownloadFileName:"taco.png",useSpriteSheet:!1,spriteSheetFileName:"spritesheet.png",imageFolderName:"images/high_res",useShadows:!0,initialLinkColor:"none"},e.dimensions={svgInitialWidth:window.innerWidth,svgInitialHeight:window.innerHeight,nodeOuterWidth:120,nodeOuterHeight:120,nodeInnerBorder:2,nodeInnerWidth:64,nodeInnerHeight:64,spriteSheetWidth:512,spriteSheetHeight:512,margin:{top:20,right:0,bottom:20,left:0}},e.durations={activateLink:750,activateNode:250},e.loadSettings=function(t){var n=t||{};n.settings=n.settings||{},Object.keys(e.settings).forEach(function(t){null!=n.settings[t]&&(e.settings[t]=n.settings[t])}),n.dimensions=n.dimensions||{},Object.keys(e.dimensions).forEach(function(t){e.dimensions[t]=n.dimensions[t]||e.dimensions[t]}),n.durations=n.durations||{},e.durations.activateLink=n.durations.activateLink||e.durations.activateLink,e.durations.activateNode=n.durations.activateNode||e.durations.activateNode},e.loadOffsets=function(t){e.offsetsData=t,t.frames.forEach(function(t){e.offsets[t.filename]=t.frame}),e.offsets["default"]=e.offsets["default"]||t.frames[0].frame,e.dimensions.spriteSheetWidth=t.meta.size.w,e.dimensions.spriteSheetHeight=t.meta.size.h},e}(techTree||{}),techTree=function(e){return e.orientNodes=function(t,n){switch(e.settings.nodeOrientation){case"vertical":e.orientNodes.vertical(t,n);break;case"horizontal":e.orientNodes.horizontal(t,n);break;case"circular":e.orientNodes.circular(t,n);break;default:e.orientNodes.vertical(t,n)}e.orientLinks()},e.orientNodes.horizontal=function(t,n){t.x=t.depth*e.dimensions.nodeOuterHeight,t.y=t._depthElementCount*e.dimensions.svgHeight/(n[t.depth]+1)-e.dimensions.nodeInnerHeight/2},e.orientNodes.vertical=function(t,n){t.x=t._depthElementCount*e.dimensions.svgWidth/(n[t.depth]+1)-e.dimensions.nodeInnerWidth/2,t.y=t.depth*e.dimensions.nodeOuterHeight},e.orientNodes.circular=function(t,n){t.x=e.dimensions.svgWidth/2-e.dimensions.nodeInnerWidth/2+120*t.depth*Math.cos(2*t._depthElementCount*Math.PI/n[t.depth]),t.y=e.dimensions.svgHeight/2-e.dimensions.nodeInnerHeight/2+120*t.depth*Math.sin(2*Math.PI*t._depthElementCount/n[t.depth])},e.orientLinks=function(){switch(e.settings.nodeOrientation){case"vertical":e.lineFunction=e.orientLinks.vertical;break;case"horizontal":e.lineFunction=e.orientLinks.horizontal;break;case"circular":e.lineFunction=e.orientLinks.horizontal;break;default:e.lineFunction=e.orientLinks.vertical}},e.orientLinks.horizontal=d3.svg.diagonal().source(function(e){return{x:e.source.y,y:e.source.x}}).target(function(e){return{x:e.target.y,y:e.target.x}}).projection(function(t){return[t.y+e.dimensions.nodeInnerHeight/2,t.x+e.dimensions.nodeInnerWidth/2]}),e.orientLinks.vertical=d3.svg.diagonal().projection(function(t){return[t.x+e.dimensions.nodeInnerWidth/2,t.y+e.dimensions.nodeInnerHeight/2]}),e}(techTree||{}),techTree=function(e){return e.clickHandler=function(e,t){if(!e.selected){var n=!0;if(e.requirements&&e.requirements.length)for(var i=0;i<e.requirements.length;i+=1)n=n&&t[e.requirements[i]].datum().selected===!0;n&&(e.selected=!0,techTree.updateNode(t[e.name]),techTree.updateLinks(e,t))}},d3.select(e.settings.downloadWrapper).on("click",function(){saveSvgAsPng(d3.select("svg").node(),e.settings.imageDownloadFileName)}),e}(techTree||{}),techTree=function(e){var t=function(t){t.append("rect").attr("width",e.dimensions.nodeInnerWidth+2*e.dimensions.nodeInnerBorder).attr("height",e.dimensions.nodeInnerHeight+2*e.dimensions.nodeInnerBorder).style("filter",e.settings.useShadows?"url(#dropshadow)":"")},n=function(t){var n,i=t.append("svg").attr("viewBox",function(t){return e.settings.useSpriteSheet?(n=e.offsets[t.name]||e.offsets["default"],"0 0 "+n.w+" "+n.h):"0 0 "+e.dimensions.nodeInnerWidth+" "+e.dimensions.nodeInnerHeight}).attr("preserveAspectRatio","xMidYMid meet").attr("x",e.dimensions.nodeInnerBorder).attr("y",e.dimensions.nodeInnerBorder).attr("width",e.dimensions.nodeInnerWidth).attr("height",e.dimensions.nodeInnerHeight).append("image").attr("image-rendering",e.settings.imageRendering).attr("xlink:href",function(t){return e.settings.useSpriteSheet?e.settings.imageFolderName+"/"+e.settings.spriteSheetFileName:e.settings.imageFolderName+"/"+t.name+".png"}).attr("x",0).attr("y",0).attr("width",e.settings.useSpriteSheet?e.dimensions.spriteSheetWidth:e.dimensions.nodeInnerWidth).attr("height",e.settings.useSpriteSheet?e.dimensions.spriteSheetHeight:e.dimensions.nodeInnerHeight).style("filter",function(e){return e.selected?"":"url(#desaturate)"});e.settings.useSpriteSheet&&i.attr("clip-path",function(e){return"url(#clip-"+e.name+")"}).attr("transform",function(t){return n=e.offsets[t.name]||e.offsets["default"],"translate(-"+n.x+",-"+n.y+")"})};return e.initializeNodes=function(i,r){i.enter().append("g").attr("class","node").attr("id",function(e,t){return r[e.name]=d3.select(this),t}).on("click",function(t){return e.clickHandler(t,r)}).attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),t(i),n(i)},e.updateNode=function(t){t.transition().duration(e.durations.activateNode).select("rect").style("fill","#ffcf70").style("stroke","#FFBB33"),t.select("image").style("filter","")},e}(techTree||{}),techTree=function(e){var t={};return e.initializeLinks=function(n){n.enter().insert("path","g").attr("class","link").attr("id",function(e){return t[e.source.name]=t[e.source.name]||[],t[e.source.name].push(d3.select(this)),e.source.name+"-"+e.target.name}).attr("d",e.lineFunction).style("stroke",function(t){return t.source.selected?"#FFBB33":e.settings.initialLinkColor})},e.updateLinks=function(n,i){var r=t[n.name];if(r&&r.length)for(var s=0;s<r.length;s+=1){r[s].transition().duration(e.durations.activateLink).style("stroke","#FFBB33");var o=r[s].datum().target,a=o.name,d=!0;if(o.requirements)for(var c=0;c<o.requirements.length;c+=1){var u=i[o.requirements[c]].datum();d=d&&u.selected,d3.transition().duration(e.durations.activateLink).select("#"+u.name+"-"+o.name).style("stroke",u.selected?"#FFBB33":"#ccc")}d&&i[a].transition().duration(e.durations.activateLink).select("rect").style("stroke","#FFBB33")}},e}(techTree||{}),techTree=function(e){return e.setupImageUtils=function(t){t.append("filter").attr("id","desaturate").append("feColorMatrix").attr("type","matrix").attr("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0");var n=t.append("filter").attr("id","dropshadow").attr("filterUnits","userSpaceOnUse").attr("color-interpolation-filters","sRGB").attr("height","130%").append("feGaussianBlur").attr("stdDeviation","2").append("feComponentTransfer").attr("in","SourceAlpha").append("feFuncR").attr("type","discrete").attr("tableValues","0");if(n.append("feOffset").attr("dx","2").attr("dy","2").attr("result","offsetblur").append("feMerge").append("feMergeNode").attr("in","SourceGraphics"),e.settings.useSpriteSheet){var i;Object.keys(e.offsets).forEach(function(t){i=e.offsets[t],d3.select("svg").append("clipPath").attr("id","clip-"+t).append("rect").attr("x",i.x).attr("y",i.y).attr("width",i.w).attr("height",i.h)})}},e}(techTree||{}),techTree=function(e){return e.createTreeFromJSON=function(e){d3.json(e.offsetsFileName,function(t,n){return t?console.warn(t):void d3.json(e.dataFileName,function(t,i){return t?console.warn(t):void d3.json(e.settingsFileName,function(e,t){return e?console.warn(e):void techTree.createTree(i.nodes,t,n)})})})},e}(techTree||{}),techTree=function(e){var t,n,i,r,s={};return e._clear=function(){n=[],i={},r={},s={}},e.deleteTree=function(){d3.select(e.settings.wrapper).select("svg").remove(),e._clear()},e.appendSVG=function(){var n=e.dimensions.margin.top,i=e.dimensions.margin.left;e.dimensions.svgWidth=e.dimensions.svgInitialWidth-e.dimensions.margin.right-i,e.dimensions.svgHeight=e.dimensions.svgInitialHeight-e.dimensions.margin.bottom-n,t=d3.select(e.settings.wrapper).append("svg").attr("width",e.dimensions.svgWidth).attr("height",e.dimensions.svgHeight).append("g").attr("transform","translate("+i+","+n+")")},e.parseNodesData=function(){var t=e.nodesData;t.forEach(function(e){r[e.name]=e}),t.forEach(function(e){s[e.depth]=s[e.depth]+1||1,e.requirements=e.requirements||[],e.requirements.forEach(function(t){n.push({source:r[t],target:e})}),e._depthElementCount=s[e.depth]}),t.forEach(function(t){e.orientNodes(t,s)})},e.createTree=function(r,s,o){e._clear(),e.nodesData=r,e.loadSettings(s),e.loadOffsets(o),e.appendSVG(),e.setupImageUtils(t),e.parseNodesData();var a=e.dimensions.nodeInnerWidth+2*e.dimensions.nodeInnerBorder,d=e.dimensions.nodeInnerHeight+2*e.dimensions.nodeInnerBorder;d3.layout.force().nodes(d3.values(e.nodesData)).links(n).size([a,d]).start(),e.init(),e.nodesData.forEach(function(e){(!e.requirements||e.requirements.length<1||e.selected)&&i[e.name].select("rect").style("fill","#ffcf70").style("stroke","#FFBB33")})},e.init=function(){var r=t.selectAll("g.node").data(e.nodesData);e.initializeNodes(r,i);var s=t.selectAll("path.link").data(n,function(e){return e.source.name+"-"+e.target.name});e.initializeLinks(s)},e}(techTree||{});
//# sourceMappingURL=techTree.min.js.map
